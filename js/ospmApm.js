!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ospmApm={})}(this,(function(t){"use strict";var e=window,n=(e.__OSPM__=e.__OSPM__||{},e.__OSPM__);n.replaceFlag=n.replaceFlag||{};var r=n.replaceFlag;function o(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function i(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},n.exports),n.exports}var s,a,u=i((function(t){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);e>n;n++)r[n]=t[n];return r},t.exports.__esModule=!0,t.exports.default=t.exports})),c=i((function(t){t.exports=function(t){if(Array.isArray(t))return u(t)},t.exports.__esModule=!0,t.exports.default=t.exports})),l=i((function(t){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.__esModule=!0,t.exports.default=t.exports})),p=i((function(t){t.exports=function(t,e){if(t){if("string"==typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports})),d=i((function(t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports})),f=o(i((function(t){t.exports=function(t){return c(t)||l(t)||p(t)||d()},t.exports.__esModule=!0,t.exports.default=t.exports})));function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){for(var n=0;e.length>n;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g(t,e,n){return e&&m(t.prototype,e),n&&m(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}!function(t){t.XHR="xhr",t.FETCH="fetch"}(s||(s={})),function(t){t[t.BAD_REQUEST=400]="BAD_REQUEST",t[t.UNAUTHORIZED=401]="UNAUTHORIZED",t[t.INTERNAL_EXCEPTION=500]="INTERNAL_EXCEPTION"}(a||(a={}));var y,x=function(){function t(){h(this,t),this.window=window,this.readyState=void 0,this.readyStateFunc={}}return g(t,null,[{key:"getInstance",value:function(){return this.instance||(this.instance=new t),this.instance}}]),t}();x.instance=void 0,function(t){t.SUCCESS="success",t.ERROR="fail"}(y||(y={}));var v,S=function(){return new Promise((function(t){x.getInstance().window.ospjsBridge?t(x.getInstance().window.ospjsBridge):document.addEventListener("ospjsBridgeReady",(function(){t(x.getInstance().window.ospjsBridge)}),!1)}))},b={register:function(){this.optionMenu(),this.pause(),this.resume(),this.titleClick(),this.goBack(),this.networkStatus(),console.log("registerJsHandlerName:optionMenu、pause、resume、titleClick、goBack、networkStatus。")},networkStatus:function(){x.getInstance().window.ospjsBridge.registerHandler("networkStatus",(function(t){var e=new Event("networkStatus");t&&Object.assign(e,{status:t}),document.dispatchEvent(e)}))},optionMenu:function(){x.getInstance().window.ospjsBridge.registerHandler("optionMenu",(function(t){var e=new Event("optionMenu");t&&Object.assign(e,{data:t}),document.dispatchEvent(e)}))},pause:function(){x.getInstance().window.ospjsBridge.registerHandler("pause",(function(){var t=new Event("pause");document.dispatchEvent(t)}))},resume:function(){x.getInstance().window.ospjsBridge.registerHandler("resume",(function(t){var e=new Event("resume");t&&Object.assign(e,{data:t}),document.dispatchEvent(e)}))},titleClick:function(){x.getInstance().window.ospjsBridge.registerHandler("titleClick",(function(){var t=new Event("titleClick");document.dispatchEvent(t)}))},goBack:function(){x.getInstance().window.ospjsBridge.registerHandler("goBack",(function(){var t=new Event("goBack");document.dispatchEvent(t)}))}},w=function(t){return new Promise((function(e){S().then((function(n){n.call("sendWebHttpLog",t,(function(){e({result:y.SUCCESS,data:"操作成功"})}))}))}))},E=function(t){return new Promise((function(e){S().then((function(n){n.call("sendHandlePerformanceTimingLog",t,(function(){e({result:y.SUCCESS,data:"操作成功"})}))}))}))};new(function(){function t(){h(this,t)}return g(t,[{key:"dataStorage",value:function(t,e){return new Promise((function(n,r){S().then((function(o){Object.assign(e,{type:t}),o.call("dataStorage",e,(function(t){return function(t,e,n){var r=JSON.parse(t);r&&r.result===y.SUCCESS?e(r):n(r)}(t,n,r)}))}))}))}},{key:"setData",value:function(t){return this.dataStorage("setData",t)}},{key:"getData",value:function(t){return this.dataStorage("getData",t)}},{key:"removeData",value:function(t){return this.dataStorage("removeData",t)}}]),t}());null!=(v=navigator.userAgent.match(/OSPMobile/i))&&(null==v?void 0:v.length)>0&&S().then((function(){b.register()}));var _=o(i((function(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports}))),T=i((function(t){function e(t,e){for(var n=0;e.length>n;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports})),O=o(T),H=i((function(t){function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports})),j=o(H),C=i((function(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports})),R=i((function(t){t.exports=function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);s=!0);}catch(t){a=!0,o=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return i}},t.exports.__esModule=!0,t.exports.default=t.exports})),A=i((function(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports})),I=(i((function(t){t.exports=function(t,e){return C(t)||R(t,e)||p(t,e)||A()},t.exports.__esModule=!0,t.exports.default=t.exports})),Object.prototype.toString);function M(t){return function(e){return I.call(e)==="[object ".concat(t,"]")}}var k={isNumber:M("Number"),isString:M("String"),isBoolean:M("Boolean"),isNull:M("Null"),isUndefined:M("Undefined"),isSymbol:M("Symbol"),isFunction:M("Function"),isObject:M("Object"),isArray:M("Array"),isProcess:M("process"),isWindow:M("Window")};function P(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.addEventListener(e,n,r)}function B(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(void 0!==t&&(e in t||r)){var o=t[e],i=n(o);"function"==typeof i&&(t[e]=i)}}var L="<anonymous>";function U(){return Date.now()}var N=function(){function t(){_(this,t),this.beforeAppAjaxSend=function(){},this.enableTraceId=void 0,this.filterXhrUrlRegExp=/(?:)/,this.includeHttpUrlTraceIdRegExp=/(?:)/,this.traceIdFieldName="Trace-Id",this.ShowHandlePerformanceTimingAlert=void 0,this.printLog=void 0,this.customHandlerHttpRequestLog=function(){},this.enableTraceId=!1,this.ShowHandlePerformanceTimingAlert=!1,this.printLog=!1,this.customHandlerHttpRequestLog=function(){}}return O(t,[{key:"bindOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.ShowHandlePerformanceTimingAlert=!!t.ShowHandlePerformanceTimingAlert,this.printLog=!!t.printLog,this.customHandlerHttpRequestLog=t.customHandlerHttpRequestLog}}]),t}(),D=n.options||(n.options=new N);function q(t,e){var n,r=D.includeHttpUrlTraceIdRegExp;if(D.enableTraceId&&r&&r.test(t)){var o=(n=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==t?e:3&e|8).toString(16)})));e(D.traceIdFieldName,o)}}function F(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.bindOptions(t)}var X=function(t,e){var n=0===t.statusCode||-1===t.statusCode||t.statusCode===a.BAD_REQUEST||t.statusCode>a.UNAUTHORIZED;0===t.statusCode&&(t.statusCode=-1),t.requestBodySize=f((null==t?void 0:t.requestBodyString)||"").length,t.responseBodySize=f((null==t?void 0:t.responseBodyString)||"").length,t.requestBodyString="",t.responseBodyString="";var r=t.fullUrl.split("://"),o=r[1].split("/"),i=r[1].substring(o[0].length).split("?")[0];t.url=t.fullUrl.split("?")[0],t.scheme=r[0],t.host=o[0].split(":")[0],t.port=o[0].split(":")[1]||"",t.path=i,w(t).then(),D.customHandlerHttpRequestLog&&D.customHandlerHttpRequestLog(t),D.printLog&&console.log(n,e,t)},J=function(t){E(t).then(),D.ShowHandlePerformanceTimingAlert&&alert(JSON.stringify(t)),console.info(t)},W=i((function(t){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},t.exports.__esModule=!0,t.exports.default=t.exports})),Z=o(W),Q=i((function(t){function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}t.exports=function(t){for(var n=1;arguments.length>n;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){W(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t},t.exports.__esModule=!0,t.exports.default=t.exports})),z=o(Q);var G={};function $(t){var e;return!(!t||r[t.type])&&(function(t,e){r[t]||(r[t]=e)}(t.type,!0),G[t.type]=G[t.type]||[],null===(e=G[t.type])||void 0===e||e.push(t.callback),!0)}function K(t,e){var n;t&&G[t]&&(null===(n=G[t])||void 0===n||n.forEach((function(n){!function(t,e){try{t()}catch(t){console.log("err",t),e&&e(t)}}((function(){n(e)}),(function(e){var r;console.error("重写事件triggerHandlers的回调函数发生错误\nType:".concat(t,"\nName: ").concat((r=n,r&&"function"==typeof r&&r.name||L),"\nError: ").concat(e))}))})))}function V(t){$(t)&&function(t){switch(t){case s.XHR:!function(){if(!("XMLHttpRequest"in e))return;var t=XMLHttpRequest.prototype;B(t,"open",(function(t){return function(){for(var e=this,n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];this.ospm_xhr={statusCode:-1,method:k.isString(r[0])?r[0].toUpperCase():r[0],fullUrl:r[1],time:U(),type:s.XHR},this.onreadystatechange=function(t){switch(e.readyState){case 0:e.ospm_xhr.readyStateInit=U();break;case 1:e.ospm_xhr.readyStateCreate=U();break;case 2:e.ospm_xhr.readyStateReceive=U();break;case 3:e.ospm_xhr.readyStateProcessing=U();break;case 4:e.ospm_xhr.readyStateDone=U()}},t.apply(this,r)}})),B(t,"send",(function(t){return function(){for(var e=this,n=arguments.length,r=Array(n),o=0;n>o;o++)r[o]=arguments[o];var i=this.ospm_xhr,a=i.method,u=i.fullUrl;q(u,(function(t,n){e.ospm_xhr.traceId=n,e.setRequestHeader(t,n)})),D.beforeAppAjaxSend({method:a,fullUrl:u},this),P(this,"loadend",(function(){var t=this.responseType,e=this.response,n=this.status;this.ospm_xhr.requestBodyString="object"===j(e)?JSON.stringify(r[0]):r[0],this.ospm_xhr.fullUrl=this.responseURL;var o=U();this.ospm_xhr.eTime=o,this.ospm_xhr.statusCode=n,-1!==["","json","text"].indexOf(t)&&(this.ospm_xhr.responseBodyString="object"===j(e)?JSON.stringify(e):e),this.ospm_xhr.elapsedTime=o-this.ospm_xhr.time,this.ospm_xhr.contentType=this.getResponseHeader("content-type")||"",K(s.XHR,this.ospm_xhr)})),t.apply(this,r)}}))}();break;case s.FETCH:!function(){if(!("fetch"in e))return;B(e,s.FETCH,(function(t){return function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=U(),i=r&&r.method||"GET",u=r&&r.body,c={statusCode:-1,time:U(),type:s.FETCH,method:i,requestBodyString:"object"===j(u)?JSON.stringify(u):u,fullUrl:n},l=new Headers(r.headers||{});Object.assign(l,{setRequestHeader:l.set}),q(n,(function(t,e){c.traceId=e,l.set(t,e)})),D.beforeAppAjaxSend({method:i,url:n},l);var p=z(z({},r),{},{headers:l}),d=new Map;return l.forEach((function(t,e){d.set(e,t)})),c.requestHeaders=d,c.contentType=l.get("content-type")||"",t.call(e,n,p).then((function(t){var e=t.clone(),n=U();return c=z(z({},c),{},{fullUrl:t.url,eTime:n,elapsedTime:n-o,statusCode:e.status,time:o}),e.text().then((function(t){c.responseBodyString=e.status>a.UNAUTHORIZED&&"object"===j(t)?JSON.stringify(t):t,K(s.FETCH,c)})),t}),(function(t){var e=U();throw c=z(z({},c),{},{eTime:e,elapsedTime:e-o,statusCode:-1,time:o}),K(s.FETCH,c),t}))}}))}()}}(t.type)}function Y(){V({callback:function(t){X(t,s.XHR)},type:s.XHR}),V({callback:function(t){X(t,s.FETCH)},type:s.FETCH})}function tt(){var t=window.location,e={href:t.href,host:t.host,port:t.port,hash:t.hash,hostname:t.hostname,pathname:t.pathname,origin:t.origin,protocol:t.protocol,search:t.search};setTimeout((function(){var t=window.performance.timing,n=z(z({},e),{},{Url:e.href,Unload:t.unloadEventEnd-t.unloadEventStart,Redirect:t.redirectEnd-t.redirectStart,AppCache:t.domainLookupStart-t.fetchStart,DNS:t.domainLookupEnd-t.domainLookupStart,TCP:t.connectEnd-t.connectStart,SSL:t.secureConnectionStart?t.connectEnd-t.secureConnectionStart:0,TimeToFirstByte:t.responseStart-t.requestStart,FirstByte:t.responseStart-t.fetchStart,ContentTransmission:t.responseEnd-t.requestStart,DOMParsing:t.domInteractive-t.responseEnd,DOMReady:t.domContentLoadedEventEnd-t.fetchStart,ResLoad:t.loadEventStart-t.domContentLoadedEventEnd,LoadEvent:t.loadEventEnd-t.loadEventStart,Loaded:t.loadEventEnd-t.fetchStart,WhiteScreenTime:t.domLoading-t.navigationStart,TimeToInteractive:t.domContentLoadedEventEnd-t.navigationStart});n=window.performance.getEntriesByType("paint").reduce((function(t,e){return z(z({},t),{},Z({},e.name.replaceAll("-",""),e.startTime))}),n),J(n)}),2e3)}t.webApmInit=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.disabled||"XMLHttpRequest"in e&&(Y(),F(t),window.addEventListener("load",tt,!1))},Object.defineProperty(t,"__esModule",{value:!0})}));
